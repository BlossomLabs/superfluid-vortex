{"version":3,"file":"AutoComplete.js","sources":["../../../../../src/components/AutoComplete/AutoComplete.js"],"sourcesContent":["import React, { useState, useRef, useCallback, useEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport { Transition, animated } from '@react-spring/web'\nimport {\n  useArrowKeysFocus,\n  useClickOutside,\n  useKeyDown,\n  useFocusLeave,\n} from '../../hooks'\nimport { springs } from '../../style'\nimport { useTheme } from '../../theme'\nimport { unselectable, noop, identity, KEY_ESC } from '../../utils'\nimport ButtonBase from '../ButtonBase/ButtonBase'\nimport SearchInput from '../Input/SearchInput'\n\nfunction AutoComplete({\n  forwardedRef,\n  itemButtonStyles = '',\n  items = [],\n  onSelect = noop,\n  onChange = noop,\n  placeholder,\n  renderItem = identity,\n  required,\n  value,\n  wide,\n}) {\n  const ref = forwardedRef\n  const uniqueItems = new Set(items)\n  const [opened, setOpened] = useState(true)\n  const wrapRef = useRef()\n  const refs = useRef([])\n\n  const handleClose = useCallback(() => setOpened(false), [])\n  const handleFocus = useCallback(() => setOpened(true), [])\n\n  const handleSelect = useCallback(\n    item => {\n      onSelect(item)\n      setOpened(false)\n    },\n    [onSelect]\n  )\n\n  const handleInputChange = useCallback(\n    (...params) => {\n      setOpened(true)\n      onChange(...params)\n    },\n    [onChange]\n  )\n\n  const { handleFocusLeave } = useFocusLeave(handleClose, wrapRef)\n  const { highlightedIndex, setHighlightedIndex } = useArrowKeysFocus(refs)\n\n  useClickOutside(handleClose, wrapRef)\n  useKeyDown(KEY_ESC, handleClose)\n\n  useEffect(() => {\n    setHighlightedIndex(-1)\n  }, [opened, items, value, setHighlightedIndex])\n\n  /* eslint-disable react/prop-types */\n  return (\n    <div css=\"position: relative\" ref={wrapRef} onBlur={handleFocusLeave}>\n      <SearchInput\n        ref={ref}\n        wide={wide}\n        placeholder={placeholder}\n        required={required}\n        onChange={handleInputChange}\n        onFocus={handleFocus}\n        value={value}\n      />\n      <Transition\n        config={springs.swift}\n        items={opened && items.length > 0}\n        from={{ scale: 0.98, opacity: 0 }}\n        enter={{ scale: 1, opacity: 1 }}\n        leave={{ scale: 1, opacity: 0 }}\n        native\n      >\n        {({ scale, opacity }, show) =>\n          show && (\n            <Items\n              style={{\n                opacity,\n                transform: scale.to(t => `scale3d(${t},${t},1)`),\n              }}\n            >\n              {Array.from(uniqueItems).map((item, index) => (\n                <Item\n                  key={item.key || item}\n                  ref={node => (refs.current[index] = node)}\n                  index={index}\n                  item={item}\n                  itemButtonStyles={itemButtonStyles}\n                  onHighlight={setHighlightedIndex}\n                  onSelect={handleSelect}\n                  selected={index === highlightedIndex}\n                >\n                  {renderItem(item, value)}\n                </Item>\n              ))}\n            </Items>\n          )\n        }\n      </Transition>\n    </div>\n  )\n  /* eslint-enable react/prop-types */\n}\n\nAutoComplete.propTypes = {\n  forwardedRef: PropTypes.object,\n  itemButtonStyles: PropTypes.string,\n  items: PropTypes.array.isRequired,\n  onSelect: PropTypes.func.isRequired,\n  onChange: PropTypes.func.isRequired,\n  placeholder: PropTypes.string,\n  renderItem: PropTypes.func,\n  required: PropTypes.bool,\n  value: PropTypes.string,\n  wide: PropTypes.bool,\n}\n\n/* eslint-disable react/prop-types */\nconst Item = React.forwardRef(function Item(\n  { children, index, item, itemButtonStyles, onHighlight, onSelect, selected },\n  ref\n) {\n  const theme = useTheme()\n\n  const handleClick = useCallback(\n    event => {\n      event.preventDefault()\n      onSelect(item)\n    },\n    [item, onSelect]\n  )\n\n  const handleFocusOrMouseOver = useCallback(() => {\n    onHighlight(index)\n  }, [index, onHighlight])\n\n  return (\n    <li\n      role=\"option\"\n      css={`\n        overflow: hidden;\n        cursor: pointer;\n        ${unselectable()};\n      `}\n    >\n      <ButtonBase\n        ref={ref}\n        onClick={handleClick}\n        onFocus={handleFocusOrMouseOver}\n        onMouseOver={handleFocusOrMouseOver}\n        css={`\n          text-align: left;\n          padding: 4px 8px;\n          width: 100%;\n          border-radius: 0;\n          border-left: 3px solid transparent;\n          cursor: pointer;\n\n          ${selected\n            ? `\n                outline: 2px solid ${theme.accent};\n                background: ${theme.surfaceHighlight};\n                border-left: 3px solid ${theme.accent};\n              `\n            : ''};\n          ${itemButtonStyles};\n        `}\n      >\n        {children}\n      </ButtonBase>\n    </li>\n  )\n})\n/* eslint-enable react/prop-types */\n\n/* eslint-disable react/prop-types */\nconst Items = function Items(props) {\n  const theme = useTheme()\n  return (\n    <animated.ul\n      role=\"listbox\"\n      css={`\n        position: absolute;\n        z-index: 2;\n        top: 100%;\n        width: 100%;\n        padding: 8px 0;\n        color: ${theme.surfaceContent};\n        background: ${theme.surface};\n        border: 1px solid ${theme.border};\n        box-shadow: 0 4px 4px 0 rgba(0, 0, 0, 0.06);\n        border-radius: 3px;\n        padding: 0;\n        margin: 0;\n        list-style: none;\n\n        & > li:first-child {\n          border-top-left-radius: 3px;\n          border-top-right-radius: 3px;\n        }\n        & > li:last-child {\n          border-bottom-left-radius: 3px;\n          border-bottom-right-radius: 3px;\n        }\n      `}\n      {...props}\n    />\n  )\n}\n/* eslint-enable react/prop-types */\n\nconst AutoCompleteMemo = React.memo(AutoComplete)\n\nexport default React.forwardRef((props, ref) => (\n  <AutoCompleteMemo {...props} forwardedRef={ref} />\n))\n"],"names":["AutoComplete","forwardedRef","itemButtonStyles","items","onSelect","noop","onChange","placeholder","renderItem","identity","required","value","wide","ref","uniqueItems","Set","opened","setOpened","useState","wrapRef","useRef","refs","handleClose","useCallback","handleFocus","handleSelect","item","handleInputChange","handleFocusLeave","useFocusLeave","highlightedIndex","setHighlightedIndex","useArrowKeysFocus","useClickOutside","useKeyDown","KEY_ESC","useEffect","React","springs","swift","length","scale","opacity","show","transform","to","t","Array","from","map","index","key","node","current","propTypes","PropTypes","object","string","array","isRequired","func","bool","Item","forwardRef","children","onHighlight","selected","theme","useTheme","handleClick","event","preventDefault","handleFocusOrMouseOver","unselectable","accent","surfaceHighlight","Items","props","surfaceContent","surface","border","AutoCompleteMemo","memo"],"mappings":"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"}