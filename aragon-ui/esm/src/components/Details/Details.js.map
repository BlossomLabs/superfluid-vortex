{"version":3,"file":"Details.js","sources":["../../../../../src/components/Details/Details.js"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useRef, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { Spring, animated } from '@react-spring/web'\nimport { useInside } from 'use-inside'\nimport { GU, springs, textStyle } from '../../style'\nimport { useTheme } from '../../theme'\nimport { IconDown } from '../../icons'\nimport ButtonBase from '../ButtonBase/ButtonBase'\n\n// Interpolate the elevation of the toggle from which the drawer slides down.\n// In / out example: [0, 0.25, 0.5, 0.75, 1] => [0, 0.5, 1, 0.5, 0]\nfunction interpolateToggleElevation(value, fn) {\n  return value.to(v => fn(1 - Math.abs(v * 2 - 1)))\n}\n\nfunction Details({ children, label, onToggle, opened: openedProp, ...props }) {\n  const theme = useTheme()\n  const [insideBox] = useInside('Box')\n  const [insideSidePanel] = useInside('SidePanel')\n\n  const contentRef = useRef(null)\n  const contentHeight = useRef(0)\n\n  // Details supports two modes: managed (internal state),\n  // or controlled (external state).\n  const [openedManaged, setOpenedManaged] = useState(false)\n  const opened = openedProp === undefined ? openedManaged : openedProp\n\n  const updateHeight = useCallback(() => {\n    if (contentRef.current) {\n      contentHeight.current = contentRef.current.clientHeight\n    }\n  }, [])\n\n  const handleContentRef = useCallback(\n    element => {\n      contentRef.current = element\n      updateHeight()\n    },\n    [updateHeight]\n  )\n\n  const handleToggle = useCallback(() => {\n    const newOpened = !opened\n\n    // Managed state\n    if (openedProp === undefined) {\n      setOpenedManaged(newOpened)\n    }\n\n    // Useful to notify even in managed mode\n    if (onToggle) {\n      onToggle(newOpened)\n    }\n  }, [onToggle, opened, openedProp])\n\n  // Animate after the initial render\n  const animate = useRef(false)\n  useEffect(() => {\n    animate.current = true\n  }, [])\n\n  // Use height: 'auto' when opened\n  const [forceHeight, setForceHeight] = useState(false)\n\n  const handleStart = useCallback(() => setForceHeight(true), [])\n  const handleRest = useCallback(() => {\n    // Note: we need to use the opened from the previous\n    // render cycle here, which is why we donâ€™t use a callback.\n    setForceHeight(!opened)\n  }, [opened])\n\n  // Update the height\n  useEffect(updateHeight, [opened, updateHeight])\n\n  const spacingCss = useMemo(() => {\n    if (insideSidePanel) {\n      return {\n        section: `\n          margin: ${2 * GU}px ${-3 * GU}px 0;\n          padding-bottom: ${3 * GU}px;\n        `,\n        content: `\n          padding: ${2 * GU}px ${3 * GU}px 0;\n        `,\n      }\n    }\n    if (insideBox) {\n      return {\n        section: `\n          margin: 0 ${-3 * GU}px;\n        `,\n        content: `\n          padding: ${1 * GU}px ${3 * GU}px 0;\n        `,\n      }\n    }\n    return {\n      section: `\n        margin: 0;\n        padding-bottom: ${3 * GU}px;\n      `,\n      content: `\n        padding: 0;\n      `,\n    }\n  }, [insideSidePanel, insideBox])\n\n  return (\n    <Spring\n      config={springs.smooth}\n      from={{ openProgress: 0 }}\n      to={{ openProgress: Number(opened) }}\n      immediate={!animate}\n      onRest={handleRest}\n      onStart={handleStart}\n      native\n    >\n      {({ openProgress }) => (\n        <section css={spacingCss.section} {...props}>\n          <ButtonBase\n            onClick={handleToggle}\n            css={`\n              position: relative;\n              width: 100%;\n              &:active {\n                background: ${theme.surfacePressed};\n              }\n            `}\n          >\n            <div\n              css={`\n                position: absolute;\n                left: ${3 * GU}px;\n                right: ${3 * GU}px;\n                bottom: 0;\n              `}\n            >\n              <animated.div\n                style={{\n                  transform: interpolateToggleElevation(\n                    openProgress,\n                    v => `scale3d(${v}, 1, 1)`\n                  ),\n                  opacity: interpolateToggleElevation(openProgress, v => v),\n                }}\n              >\n                <div\n                  css={`\n                    height: 1px;\n                    box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);\n                  `}\n                />\n              </animated.div>\n            </div>\n\n            <h1\n              css={`\n                display: flex;\n                justify-content: flex-start;\n                align-items: center;\n                height: ${5 * GU}px;\n                margin-left: ${3 * GU}px;\n                color: ${theme.surfaceContentSecondary};\n                ${textStyle('label2')}\n                font-weight: 400;\n              `}\n              {...props}\n            >\n              <div\n                css={`\n                  margin-top: 2px;\n                `}\n              >\n                {label}\n              </div>\n              <div>\n                <animated.div\n                  style={{\n                    marginLeft: `${1 * GU}px`,\n                    transform: openProgress.to(\n                      v => `rotate(${(1 - v) * 180}deg)`\n                    ),\n                    transformOrigin: '50% calc(50% - 0.5px)',\n                  }}\n                >\n                  <div\n                    css={`\n                      display: flex;\n                      align-items: center;\n                      justify-content: center;\n                    `}\n                  >\n                    <IconDown size=\"tiny\" />\n                  </div>\n                </animated.div>\n              </div>\n            </h1>\n          </ButtonBase>\n          <div css=\"overflow: hidden\">\n            <animated.div\n              css={`\n                display: flex;\n                flex-direction: column;\n                justify-content: flex-end;\n              `}\n              style={{\n                opacity: openProgress,\n                height: forceHeight\n                  ? openProgress.to(v => `${v * contentHeight.current}px`)\n                  : 'auto',\n              }}\n            >\n              <div ref={handleContentRef} css={spacingCss.content}>\n                <div>{children}</div>\n              </div>\n            </animated.div>\n          </div>\n        </section>\n      )}\n    </Spring>\n  )\n}\n\nDetails.propTypes = {\n  children: PropTypes.node.isRequired,\n  label: PropTypes.string.isRequired,\n  onToggle: PropTypes.func,\n  opened: PropTypes.bool,\n}\n\nexport default Details\n"],"names":["interpolateToggleElevation","value","fn","to","v","Math","abs","Details","children","label","onToggle","opened","openedProp","props","theme","useTheme","insideBox","useInside","insideSidePanel","contentRef","useRef","contentHeight","openedManaged","setOpenedManaged","useState","undefined","updateHeight","useCallback","current","clientHeight","handleContentRef","element","handleToggle","newOpened","animate","useEffect","forceHeight","setForceHeight","handleStart","handleRest","spacingCss","useMemo","section","GU","content","React","springs","smooth","openProgress","Number","surfacePressed","transform","opacity","surfaceContentSecondary","textStyle","marginLeft","transformOrigin","height","propTypes","PropTypes","node","isRequired","string","func","bool"],"mappings":"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"}