{"version":3,"file":"Viewport.js","sources":["../../../../../src/providers/Viewport/Viewport.js"],"sourcesContent":["import React from 'react'\nimport PropTypes from 'prop-types'\nimport { BREAKPOINTS } from '../../style'\nimport throttle from 'lodash.throttle'\n\nconst NO_DOM_WINDOW_SIZE = { width: 0, height: 0 }\n\nconst WINDOW_SIZE_BASE = { breakpoints: BREAKPOINTS, ...getCurrentWindowSize() }\n\nconst ViewportContext = React.createContext(WINDOW_SIZE_BASE)\n\nfunction getCurrentWindowSize() {\n  return typeof window === 'undefined'\n    ? NO_DOM_WINDOW_SIZE\n    : { width: window.innerWidth, height: window.innerHeight }\n}\n\nclass ViewportProvider extends React.Component {\n  static propTypes = {\n    children: PropTypes.node,\n    throttle: PropTypes.number,\n  }\n\n  static defaultProps = {\n    throttle: 100,\n  }\n\n  state = { windowSize: this.getWindowSize() }\n\n  componentDidMount() {\n    this.resizeStart()\n  }\n\n  componentWillUnmount() {\n    this.resizeStop()\n  }\n\n  componentDidUpdate(prevProps) {\n    const { throttle } = this.props\n    if (prevProps.throttle !== throttle) {\n      this.resizeStop()\n      this.resizeStart()\n    }\n  }\n\n  resizeStart() {\n    this._handleResize = throttle(this.updateWindowSize, this.props.throttle)\n    this.updateWindowSize()\n\n    if (typeof window !== 'undefined') {\n      window.addEventListener('resize', this._handleResize)\n    }\n  }\n\n  resizeStop() {\n    if (!this._handleResize) {\n      return\n    }\n    if (typeof window !== 'undefined') {\n      window.removeEventListener('resize', this._handleResize)\n    }\n    this._handleResize.cancel()\n    delete this._handleResize\n  }\n\n  updateWindowSize = () => {\n    this.setState({ windowSize: this.getWindowSize() })\n  }\n\n  getWindowSize() {\n    return {\n      ...WINDOW_SIZE_BASE,\n      ...getCurrentWindowSize(),\n    }\n  }\n\n  // Check if the current width is between two points.\n  // Accepts a breakpoint string ('small', 'large') or numbers (width in pixels).\n  // `min` is inclusive and `max` is exclusive.\n  within = (min, max) => {\n    const { width } = this.state.windowSize\n\n    // Accept \"\" or -1 indifferently\n    if (min === '') min = -1\n    if (max === '') max = -1\n\n    // Convert breakpoints into numbers\n    if (typeof min === 'string') min = BREAKPOINTS[min]\n    if (typeof max === 'string') max = BREAKPOINTS[max]\n\n    if (typeof min !== 'number') {\n      throw new Error(`Viewport: invalid minimum value (${min}).`)\n    }\n    if (typeof max !== 'number') {\n      throw new Error(`Viewport: invalid maximum value (${max}).`)\n    }\n\n    return (min === -1 || width >= min) && (max === -1 || width < max)\n  }\n\n  above = value => this.within(value, -1)\n  below = value => this.within(-1, value)\n\n  render() {\n    const { windowSize } = this.state\n    const { children } = this.props\n    const { within, above, below } = this\n    return (\n      <ViewportContext.Provider value={{ ...windowSize, within, above, below }}>\n        {children}\n      </ViewportContext.Provider>\n    )\n  }\n}\n\n// React emits a warning message if `Provider` is attached to `Consumer`, this\n// is only to prevent it.\nconst Viewport = props => <ViewportContext.Consumer {...props} />\n\nViewport.Provider = ViewportProvider\n\nexport const useViewport = () => React.useContext(ViewportContext)\nexport { Viewport }\nexport default Viewport\n"],"names":["NO_DOM_WINDOW_SIZE","width","height","WINDOW_SIZE_BASE","breakpoints","BREAKPOINTS","getCurrentWindowSize","ViewportContext","React","createContext","window","innerWidth","innerHeight","ViewportProvider","Component","windowSize","getWindowSize","setState","min","max","state","Error","value","within","componentDidMount","resizeStart","componentWillUnmount","resizeStop","componentDidUpdate","prevProps","throttle","props","_handleResize","updateWindowSize","addEventListener","removeEventListener","cancel","render","children","above","below","PropTypes","node","number","Viewport","Provider","useViewport","useContext"],"mappings":"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"}