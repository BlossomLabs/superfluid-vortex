{"version":3,"file":"useImageExists.js","sources":["../../../../src/hooks/useImageExists.js"],"sourcesContent":["import { useEffect, useMemo, useState } from 'react'\nimport cachedMap from '../lib/cached-map'\n\nconst srcCache = cachedMap()\n\n// Check if a remote image exists and can be loaded within a specific amount of time.\nexport function useImageExists(src, timeUntilFallback = 50) {\n  const [exists, setExists] = useState(false)\n  const [loading, setLoading] = useState(true)\n  const [displayFallback, setDisplayFallback] = useState(false)\n\n  useEffect(() => {\n    let image = new Image()\n    const fallbackTimer = setTimeout(\n      () => setDisplayFallback(true),\n      timeUntilFallback\n    )\n\n    const init = () => {\n      if (!src) {\n        setExists(false)\n        setLoading(false)\n        return\n      }\n\n      if (srcCache.get(src)) {\n        success()\n        return\n      }\n\n      setExists(false)\n      setLoading(true)\n\n      // TODO: ensure only one image is loading at a time for a given src.\n      image.addEventListener('load', success)\n      image.src = src\n    }\n\n    const success = () => {\n      setLoading(false)\n      setExists(true)\n      srcCache.set(src, true)\n      done()\n    }\n\n    const done = () => {\n      clearTimeout(fallbackTimer)\n      if (image) {\n        image.removeEventListener('load', success)\n        image = null\n      }\n    }\n\n    init()\n\n    return done\n  }, [src, timeUntilFallback])\n\n  return useMemo(() => {\n    return { src, displayFallback, exists, loading }\n  }, [src, displayFallback, exists, loading])\n}\n\n// render prop\nexport const ImageExists = ({ timeUntilFallback, src, children }) =>\n  children(useImageExists(src, timeUntilFallback))\n"],"names":["srcCache","cachedMap","useImageExists","src","timeUntilFallback","exists","setExists","useState","loading","setLoading","displayFallback","setDisplayFallback","useEffect","image","Image","fallbackTimer","setTimeout","init","get","success","addEventListener","set","done","clearTimeout","removeEventListener","useMemo","ImageExists","children"],"mappings":";;;AAGA,MAAMA,QAAQ,GAAGC,SAAS,EAA1B;;AAGO,SAASC,cAAT,CAAwBC,GAAxB,EAAqD;AAAA,EAAxBC,IAAAA,iBAAwB,uEAAJ,EAAI,CAAA;AAC1D,EAAM,MAAA,CAACC,MAAD,EAASC,SAAT,IAAsBC,QAAQ,CAAC,KAAD,CAApC,CAAA;AACA,EAAM,MAAA,CAACC,OAAD,EAAUC,UAAV,IAAwBF,QAAQ,CAAC,IAAD,CAAtC,CAAA;AACA,EAAM,MAAA,CAACG,eAAD,EAAkBC,kBAAlB,IAAwCJ,QAAQ,CAAC,KAAD,CAAtD,CAAA;AAEAK,EAAAA,SAAS,CAAC,MAAM;AACd,IAAA,IAAIC,KAAK,GAAG,IAAIC,KAAJ,EAAZ,CAAA;AACA,IAAMC,MAAAA,aAAa,GAAGC,UAAU,CAC9B,MAAML,kBAAkB,CAAC,IAAD,CADM,EAE9BP,iBAF8B,CAAhC,CAAA;;AAKA,IAAMa,MAAAA,IAAI,GAAG,MAAM;AACjB,MAAI,IAAA,CAACd,GAAL,EAAU;AACRG,QAAAA,SAAS,CAAC,KAAD,CAAT,CAAA;AACAG,QAAAA,UAAU,CAAC,KAAD,CAAV,CAAA;AACA,QAAA,OAAA;AACD,OAAA;;AAED,MAAA,IAAIT,QAAQ,CAACkB,GAAT,CAAaf,GAAb,CAAJ,EAAuB;AACrBgB,QAAAA,OAAO,EAAA,CAAA;AACP,QAAA,OAAA;AACD,OAAA;;AAEDb,MAAAA,SAAS,CAAC,KAAD,CAAT,CAAA;AACAG,MAAAA,UAAU,CAAC,IAAD,CAAV,CAbiB;;AAgBjBI,MAAAA,KAAK,CAACO,gBAAN,CAAuB,MAAvB,EAA+BD,OAA/B,CAAA,CAAA;AACAN,MAAAA,KAAK,CAACV,GAAN,GAAYA,GAAZ,CAAA;AACD,KAlBD,CAAA;;AAoBA,IAAMgB,MAAAA,OAAO,GAAG,MAAM;AACpBV,MAAAA,UAAU,CAAC,KAAD,CAAV,CAAA;AACAH,MAAAA,SAAS,CAAC,IAAD,CAAT,CAAA;AACAN,MAAAA,QAAQ,CAACqB,GAAT,CAAalB,GAAb,EAAkB,IAAlB,CAAA,CAAA;AACAmB,MAAAA,IAAI,EAAA,CAAA;AACL,KALD,CAAA;;AAOA,IAAMA,MAAAA,IAAI,GAAG,MAAM;AACjBC,MAAAA,YAAY,CAACR,aAAD,CAAZ,CAAA;;AACA,MAAA,IAAIF,KAAJ,EAAW;AACTA,QAAAA,KAAK,CAACW,mBAAN,CAA0B,MAA1B,EAAkCL,OAAlC,CAAA,CAAA;AACAN,QAAAA,KAAK,GAAG,IAAR,CAAA;AACD,OAAA;AACF,KAND,CAAA;;AAQAI,IAAAA,IAAI,EAAA,CAAA;AAEJ,IAAA,OAAOK,IAAP,CAAA;AACD,GA7CQ,EA6CN,CAACnB,GAAD,EAAMC,iBAAN,CA7CM,CAAT,CAAA;AA+CA,EAAOqB,OAAAA,OAAO,CAAC,MAAM;AACnB,IAAO,OAAA;AAAEtB,MAAAA,GAAF;AAAOO,MAAAA,eAAP;AAAwBL,MAAAA,MAAxB;AAAgCG,MAAAA,OAAAA;AAAhC,KAAP,CAAA;AACD,GAFa,EAEX,CAACL,GAAD,EAAMO,eAAN,EAAuBL,MAAvB,EAA+BG,OAA/B,CAFW,CAAd,CAAA;AAGD;;AAGM,MAAMkB,WAAW,GAAG,IAAA,IAAA;AAAA,EAAC,IAAA;AAAEtB,IAAAA,iBAAF;AAAqBD,IAAAA,GAArB;AAA0BwB,IAAAA,QAAAA;AAA1B,GAAD,GAAA,IAAA,CAAA;AAAA,EACzBA,OAAAA,QAAQ,CAACzB,cAAc,CAACC,GAAD,EAAMC,iBAAN,CAAf,CADiB,CAAA;AAAA;;;;"}