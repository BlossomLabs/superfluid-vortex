{"version":3,"file":"SidePanel.js","sources":["../src/components/SidePanel/SidePanel.js"],"sourcesContent":["import React, {\n  useCallback,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} from 'react'\nimport PropTypes from 'prop-types'\nimport { Transition, animated } from '@react-spring/web'\nimport { Inside } from 'use-inside'\nimport ButtonIcon from '../Button/ButtonIcon'\nimport { IconClose } from '../../icons'\nimport { useViewport } from '../../providers/Viewport/Viewport'\nimport { GU, springs, textStyle } from '../../style'\nimport { useTheme } from '../../theme'\nimport { unselectable, KEY_ESC, warn } from '../../utils'\nimport RootPortal from '../RootPortal/RootPortal'\n\nconst CONTENT_PADDING = 3 * GU\n\n// The closing position of the panel, on the right side of the viewport.\n// It takes into consideration the shadow of the panel.\nconst CLOSING_POSITION = 5 * GU\n\nconst SidePanelContext = React.createContext(null)\n\nfunction SidePanel({\n  blocking,\n  children,\n  opened,\n  onClose,\n  onTransitionEnd,\n  title,\n}) {\n  const theme = useTheme()\n  const { below } = useViewport()\n  const compact = below('medium')\n\n  const close = useCallback(() => {\n    if (!blocking) {\n      onClose()\n    }\n  }, [blocking, onClose])\n\n  const handleEscape = useCallback(\n    event => {\n      if (event.keyCode === KEY_ESC && opened) {\n        close()\n      }\n    },\n    [opened, close]\n  )\n\n  const [status, setStatus] = useState(opened ? 'opened' : 'closed')\n  const [readyToFocus, setReadyToFocus] = useState(false)\n\n  const handleTransitionRest = useCallback(() => {\n    onTransitionEnd(opened)\n    setStatus(opened ? 'opened' : 'closed')\n  }, [opened, onTransitionEnd])\n\n  const handleTransitionStart = useCallback(() => {\n    setStatus(opened ? 'opening' : 'closing')\n  }, [opened])\n\n  const handleTransitionFrame = useCallback(\n    (item, _, { progress }) => {\n      if (progress > 0.5 && !readyToFocus) {\n        setReadyToFocus(true)\n      } else if (progress < 0.5 && readyToFocus) {\n        setReadyToFocus(false)\n      }\n    },\n    [readyToFocus]\n  )\n\n  const handleTransitionDestroyed = useCallback(() => {\n    setReadyToFocus(false)\n  }, [])\n\n  useEffect(() => {\n    document.addEventListener('keydown', handleEscape)\n    return () => {\n      document.removeEventListener('keydown', handleEscape)\n    }\n  }, [handleEscape])\n\n  return (\n    <RootPortal>\n      <Inside name=\"SidePanel\">\n        <Transition\n          items={opened}\n          config={{ ...springs.lazy, precision: 0.001 }}\n          from={{ progress: 0 }}\n          enter={{ progress: Number(opened) }}\n          leave={{ progress: 0 }}\n          onRest={handleTransitionRest}\n          onStart={handleTransitionStart}\n          onFrame={handleTransitionFrame}\n          onDestroyed={handleTransitionDestroyed}\n          unique\n          native\n        >\n          {({ progress }, show) =>\n            show && (\n              <div\n                css={`\n                  position: absolute;\n                  z-index: 1;\n                  top: 0;\n                  left: 0;\n                  right: 0;\n                  bottom: 0;\n                  pointer-events: ${status !== 'closing' ? 'auto' : 'none'};\n                  overflow: hidden;\n                `}\n              >\n                <animated.div\n                  onClick={close}\n                  style={{\n                    opacity: progress,\n                    pointerEvents: status !== 'closing' ? 'auto' : 'none',\n                  }}\n                  css={`\n                    position: absolute;\n                    top: 0;\n                    left: 0;\n                    right: 0;\n                    bottom: 0;\n                    background: ${theme.overlay.alpha(0.9)};\n                  `}\n                />\n                <Panel\n                  compact={compact}\n                  style={{\n                    transform: progress.to(\n                      v =>\n                        `\n                          translate3d(\n                            calc(\n                              ${100 * (1 - v)}% +\n                              ${CLOSING_POSITION * (1 - v)}px\n                            ), 0, 0\n                          )\n                        `\n                    ),\n                  }}\n                >\n                  <header\n                    css={`\n                      display: flex;\n                      flex-direction: column;\n                      justify-content: center;\n                      flex-shrink: 0;\n                      position: relative;\n                      height: ${8 * GU}px;\n                      padding-left: ${CONTENT_PADDING}px;\n                      border-bottom: 1px solid ${theme.border};\n                      ${unselectable()};\n                    `}\n                  >\n                    <h1\n                      css={`\n                        color: ${theme.surfaceContent};\n                        ${textStyle('body1')};\n                      `}\n                    >\n                      {title}\n                    </h1>\n                    {!blocking && (\n                      <ButtonIcon\n                        label=\"Close\"\n                        onClick={close}\n                        css={`\n                          position: absolute;\n                          ${!compact\n                            ? `\n                              top: ${2 * GU}px;\n                              right: ${2 * GU}px;\n                            `\n                            : `\n                              top: 0;\n                              right: 0;\n                              height: ${8 * GU}px;\n                              width: ${8 * GU}px;\n                            `}\n                        `}\n                      >\n                        <IconClose color={theme.surfaceIcon} />\n                      </ButtonIcon>\n                    )}\n                  </header>\n                  <div\n                    css={`\n                      overflow-y: auto;\n                      height: 100%;\n                      display: flex;\n                      flex-direction: column;\n                    `}\n                  >\n                    <div\n                      css={`\n                        min-height: 0;\n                        flex-grow: 1;\n                        flex-shrink: 0;\n                        display: flex;\n                        flex-direction: column;\n                        width: 100%;\n                        padding-right: ${CONTENT_PADDING}px;\n                        padding-left: ${CONTENT_PADDING}px;\n                        padding-bottom: ${CONTENT_PADDING}px;\n                      `}\n                    >\n                      <SidePanelContext.Provider\n                        value={{ status, readyToFocus }}\n                      >\n                        {children}\n                      </SidePanelContext.Provider>\n                    </div>\n                  </div>\n                </Panel>\n              </div>\n            )\n          }\n        </Transition>\n      </Inside>\n    </RootPortal>\n  )\n}\n\nSidePanel.propTypes = {\n  blocking: PropTypes.bool,\n  children: PropTypes.node.isRequired,\n  opened: PropTypes.bool,\n  onClose: PropTypes.func,\n  onTransitionEnd: PropTypes.func,\n  title: PropTypes.node.isRequired,\n}\n\nSidePanel.defaultProps = {\n  opened: true,\n  blocking: false,\n  onClose: () => {},\n  onTransitionEnd: () => {},\n}\n\nconst Panel = React.memo(function Panel({ compact, ...props }) {\n  const theme = useTheme()\n  return (\n    <animated.aside\n      css={`\n        position: absolute;\n        top: 0;\n        right: 0;\n        display: flex;\n        flex-direction: column;\n        width: 100%;\n        height: 100%;\n        background: ${theme.surface};\n        box-shadow: -2px 0px 4px rgba(0, 0, 0, 0.1);\n        ${!compact ? 'max-width: 450px;' : ''}\n      `}\n      {...props}\n    />\n  )\n})\n\nPanel.propTypes = {\n  compact: PropTypes.bool,\n}\n\nfunction useSidePanel() {\n  const value = useContext(SidePanelContext)\n  if (value === null) {\n    throw new Error(\n      'useSidePanel() was used outside of the SidePanel render tree, ' +\n        'which has to be declared at an upper level!'\n    )\n  }\n  return value\n}\n\nfunction useSidePanelFocusOnReady(ref) {\n  const { readyToFocus } = useSidePanel()\n  const fallbackRef = useRef()\n\n  const _ref = ref || fallbackRef\n\n  useEffect(() => {\n    if (readyToFocus && _ref.current) {\n      if (_ref.current.focus) {\n        _ref.current.focus()\n      } else {\n        warn(\n          'useSidePanelFocusOnReady(): the focus() method wasnâ€™t available on ' +\n            'the passed ref.'\n        )\n      }\n    }\n  }, [readyToFocus, _ref])\n\n  return _ref\n}\n\n// Used for spacing in SidePanelSplit and SidePanelSeparator\nSidePanel.HORIZONTAL_PADDING = CONTENT_PADDING\n\nexport { useSidePanel, useSidePanelFocusOnReady }\nexport default SidePanel\n"],"names":["CONTENT_PADDING","GU","CLOSING_POSITION","SidePanelContext","React","createContext","SidePanel","blocking","children","opened","onClose","onTransitionEnd","title","theme","useTheme","below","useViewport","compact","close","useCallback","handleEscape","event","keyCode","KEY_ESC","status","setStatus","useState","readyToFocus","setReadyToFocus","handleTransitionRest","handleTransitionStart","handleTransitionFrame","item","_","progress","handleTransitionDestroyed","useEffect","document","addEventListener","removeEventListener","RootPortal","Inside","Transition","springs","lazy","precision","Number","show","opacity","pointerEvents","overlay","alpha","transform","to","v","border","unselectable","surfaceContent","textStyle","IconClose","surfaceIcon","propTypes","PropTypes","bool","node","isRequired","func","defaultProps","Panel","memo","props","surface","useSidePanel","value","useContext","Error","useSidePanelFocusOnReady","ref","fallbackRef","useRef","_ref","current","focus","warn","HORIZONTAL_PADDING"],"mappings":"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"}