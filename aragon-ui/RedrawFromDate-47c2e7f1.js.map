{"version":3,"file":"RedrawFromDate-47c2e7f1.js","sources":["../src/providers/RedrawFromDate/RedrawFromDate.js"],"sourcesContent":["import React from 'react'\nimport PropTypes from 'prop-types'\nimport getDisplayName from 'react-display-name'\nimport dayjs from 'dayjs'\nimport { difference } from '../../utils/date'\n\n// Render prop component for re-rendering based on a given date. Automatically\n// adjusts the re-render timer to be one second, minute, or hour based on the\n// fromDate prop.\n// For a discussion on pitfalls, see\n// https://gist.github.com/staltz/08bf613199092eeb41ac8137d51eb5e6\n\nconst EVERY_SECOND = 1000\nconst EVERY_MINUTE = EVERY_SECOND * 60\nconst EVERY_HOUR = EVERY_MINUTE * 60\n\nconst getRedrawTime = fromDate => {\n  const { days, hours, minutes } = difference(new Date(), fromDate)\n  return hours || days ? EVERY_HOUR : minutes > 1 ? EVERY_MINUTE : EVERY_SECOND\n}\n\nclass RedrawFromDate extends React.Component {\n  static propTypes = {\n    children: PropTypes.func.isRequired,\n    fromDate: PropTypes.oneOfType([\n      PropTypes.string,\n      PropTypes.number,\n      PropTypes.instanceOf(Date),\n    ]).isRequired,\n  }\n  state = {\n    redrawTime: EVERY_HOUR,\n    lastDraw: -1,\n  }\n  componentDidMount() {\n    const { fromDate } = this.props\n    if (fromDate) {\n      this.restartDrawInterval(getRedrawTime(fromDate))\n    }\n  }\n  componentWillReceiveProps({ fromDate }) {\n    if (!fromDate && this.props.fromDate) {\n      this.clearInterval()\n    } else if (!dayjs(fromDate).isSame(this.props.fromDate)) {\n      this.restartDrawInterval(getRedrawTime(this.props.fromDate))\n    }\n  }\n  componentWillUnmount() {\n    this.clearInterval()\n  }\n  clearInterval = () => {\n    this.interval && clearInterval(this.interval)\n  }\n  restartDrawInterval = redrawTime => {\n    this.clearInterval()\n\n    this.interval = setInterval(() => {\n      this.setState({ lastDraw: Date.now() })\n\n      const newRedrawTime = getRedrawTime(this.props.fromDate)\n      if (newRedrawTime !== redrawTime) {\n        this.restartDrawInterval(newRedrawTime)\n      }\n    }, redrawTime)\n  }\n  render() {\n    return this.props.children()\n  }\n}\n\nconst hocWrap = Component => {\n  const HOC = props => (\n    <RedrawFromDate fromDate={props.fromDate}>\n      {() => <Component {...props} />}\n    </RedrawFromDate>\n  )\n  HOC.propTypes = {\n    fromDate: RedrawFromDate.propTypes.fromDate,\n  }\n  HOC.displayName = `RedrawFromDate(${getDisplayName(Component)})`\n  return HOC\n}\n\nRedrawFromDate.hocWrap = hocWrap\n\nexport { RedrawFromDate, hocWrap }\nexport default RedrawFromDate\n"],"names":["EVERY_SECOND","EVERY_MINUTE","EVERY_HOUR","getRedrawTime","fromDate","days","hours","minutes","difference","Date","RedrawFromDate","React","Component","_defineProperty","redrawTime","lastDraw","interval","clearInterval","setInterval","setState","now","newRedrawTime","props","restartDrawInterval","componentDidMount","componentWillReceiveProps","dayjs","isSame","componentWillUnmount","render","children","PropTypes","func","isRequired","oneOfType","string","number","instanceOf","hocWrap","HOC","propTypes","displayName","getDisplayName"],"mappings":"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"}